<%# app/views/users/show.html.erb %>
<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h2><i class="fas fa-user"></i> <%= @user.full_name %>'s Profile</h2>
        </div>
        <div class="card-body">
          <div class="row">
            <!-- Personal Information Section -->
            <div class="col-md-6">
              <div class="card mb-4">
                <div class="card-header">
                  <h4><i class="fas fa-info-circle"></i> Personal Information</h4>
                </div>
                <div class="card-body">
                  <p><strong>Name:</strong> <%= @user.full_name %></p>
                  <p><strong>Email:</strong> <%= @user.email %></p>
                  <p><strong>Member since:</strong> <%= @user.created_at.strftime("%B %Y") %></p>
                  
                  <% if current_user != @user %>
                    <div class="mt-3">
                      <% if current_user.friends_with?(@user) %>
                        <%= button_to 'Remove Friend', remove_friend_path, 
                            method: :delete,
                            params: { friend_id: @user.id },
                            class: "btn btn-outline-danger btn-sm",
                            data: { confirm: "Remove #{@user.full_name} from friends?" } %>
                        <span class="badge bg-success ms-2">Friends</span>
                      <% else %>
                        <%= button_to 'Add Friend', add_friend_path, 
                            method: :post,
                            params: { friend_id: @user.id },
                            class: "btn btn-primary btn-sm" %>
                      <% end %>
                    </div>
                  <% else %>
                    <div class="alert alert-info mt-3">
                      <i class="fas fa-user-circle"></i> This is your profile
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
            
            <!-- Stock Portfolio Section -->
            <div class="col-md-6">
              <div class="card mb-4">
                <div class="card-header">
                  <h4><i class="fas fa-chart-line"></i> Stock Portfolio 
                    <span class="badge bg-secondary"><%= @tracked_stocks.count %> stocks</span>
                  </h4>
                </div>
                <div class="card-body">
                  <% if @tracked_stocks.any? %>
                    <div class="table-responsive">
                      <table class="table table-hover table-sm">
                        <thead class="table-light">
                          <tr>
                            <th>Ticker</th>
                            <th>Company</th>
                            <th>Price</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% @tracked_stocks.each do |stock| %>
                            <tr>
                              <td><strong><%= stock.ticker %></strong></td>
                              <td><%= truncate(stock.name, length: 25) %></td>
                              <td><span class="badge bg-success">$<%= stock.last_price %></span></td>
                            </tr>
                          <% end %>
                        </tbody>
                      </table>
                    </div>
                  <% else %>
                    <div class="text-center text-muted">
                      <i class="fas fa-chart-line fa-3x mb-3"></i>
                      <p>No stocks tracked yet.</p>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Friends Section -->
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h4><i class="fas fa-users"></i> Friends 
                    <span class="badge bg-secondary"><%= @friends.count %></span>
                  </h4>
                </div>
                <div class="card-body">
                  <% if @friends.any? %>
                    <div class="row">
                      <% @friends.each do |friend| %>
                        <div class="col-md-4 col-lg-3 mb-3">
                          <div class="card h-100">
                            <div class="card-body text-center">
                              <div class="mb-2">
                                <i class="fas fa-user-circle fa-2x text-primary"></i>
                              </div>
                              <h6 class="card-title"><%= friend.full_name %></h6>
                              <p class="card-text text-muted small"><%= friend.email %></p>
                              <%= link_to 'View Profile', user_profile_path(friend), 
                                  class: 'btn btn-sm btn-outline-primary' %>
                            </div>
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% else %>
                    <div class="text-center text-muted">
                      <i class="fas fa-users fa-3x mb-3"></i>
                      <p>No friends yet.</p>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Navigation -->
          <div class="row mt-4">
            <div class="col-12 text-center">
              <%= link_to 'Back to My Friends', my_friends_path, class: 'btn btn-secondary me-2' %>
              <%= link_to 'My Portfolio', my_portfolio_path, class: 'btn btn-outline-primary' %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>